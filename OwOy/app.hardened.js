(function(){'use strict';var S=["OwO Browser-cloaked","OwO Browser-wisp-key","OwO Browser-custom-wisp","loading-screen","settings-modal","cloak-toggle-btn","favicon","bar","frame-container","new-tab-ui","tab-strip","active-wisp","nav-hidden","Search with Brave or enter URL","SW register failed:","successfully connected to custom wisp server","failed to connect to custom wisp server url","ERR","--ms"];function s(i){return S[i];}function G(id){return document.getElementById(id);}function QS(q,r){return(r||document).querySelector(q);}function QSA(q,r){return Array.prototype.slice.call((r||document).querySelectorAll(q));}var BASE=new URL('./',location.href);function U(p){return new URL(String(p).replace(/^\/+/,''),BASE).toString();}function P(p){return new URL(String(p).replace(/^\/+/,''),BASE).pathname;}function regSW(){if(!('serviceWorker'in navigator))return;addEventListener('load',function(){navigator.serviceWorker.register(U('sw.js'),{scope:P('./')}).catch(function(e){console.error(s(14),e);});});}regSW();var W={main:"wss://dywhmcwp1y96m.cloudfront.net/wisp/",backup2:"wss://studyworkandmore.uk/wisp/",backup3:"wss://echo.websocket.org/",backup4:"wss://ws.ifelse.io/",backup5:"wss://2662r3426b.vicp.fun/xiaozhi/v1/",backup6:"wss://anura.pro/",backup7:"wss://gointospace.app/wisp/",backup8:"wss://dash.goip.de/wisp/",backup9:"wss://dash.goip.de/wisp/",backup10:""};var T=[],A=null,C=W.main;var CONN=new BareMux.BareMuxConnection(U('baremux/worker.js'));function initProxy(){CONN.setTransport(U('libcurl/index.mjs'),[{websocket:C}]);}var PFX=new URL('./go/',location.href).pathname;var ScramjetController=$scramjetLoadController().ScramjetController;var SJ=new ScramjetController({files:{all:U('scram/scramjet.all.js'),wasm:U('scram/scramjet.wasm.wasm'),sync:U('scram/scramjet.sync.js')},prefix:PFX});function cloakUI(){var v=localStorage.getItem(s(0))==='true';var b=G(s(5));if(v){document.title='My Drive - Google Drive';G(s(6)).href='https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png';if(b){b.innerText='Disable Tab Cloaking';b.classList.add(s(11));}}else{document.title='OwO Browser';G(s(6)).href='./favico.ico';if(b){b.innerText='Enable Tab Cloaking (Drive)';b.classList.remove(s(11));}}}function toggleC(){var v=localStorage.getItem(s(0))==='true';localStorage.setItem(s(0),String(!v));cloakUI();}function loadWisp(){var k=localStorage.getItem(s(1));var cw=localStorage.getItem(s(2));if(cw){C=cw;var inp=G('custom-wisp-url');if(inp)inp.value=cw;QSA('.'+s(11)).forEach(function(x){x.classList.remove(s(11));});}else if(k&&W[k]){C=W[k];QSA('.'+s(11)).forEach(function(x){x.classList.remove(s(11));});var btn=G('wisp-'+k);if(btn)btn.classList.add(s(11));}}function setW(t){if(!W[t])return;C=W[t];localStorage.setItem(s(1),t);localStorage.removeItem(s(2));QSA('.'+s(11)).forEach(function(x){x.classList.remove(s(11));});var b=G('wisp-'+t);if(b)b.classList.add(s(11));initProxy();}function setCW(){var inp=G('custom-wisp-url');var url=inp?String(inp.value||'').trim():'';if(!(url.startsWith('ws://')||url.startsWith('wss://'))){alert(s(16));return;}var sock;try{sock=new WebSocket(url);}catch(e){alert(s(16));return;}var tm=setTimeout(function(){try{sock.close();}catch(e){}alert(s(16));},5000);sock.onopen=function(){clearTimeout(tm);C=url;localStorage.setItem(s(2),url);localStorage.removeItem(s(1));QSA('.'+s(11)).forEach(function(x){x.classList.remove(s(11));});initProxy();try{sock.close();}catch(e){}alert(s(15));};sock.onerror=function(){clearTimeout(tm);alert(s(16));};}function ping(url,elId){if(!url||!(url.startsWith('ws://')||url.startsWith('wss://')))return;var st=Date.now();try{var ws=new WebSocket(url);var tm=setTimeout(function(){try{ws.close();}catch(e){}},3000);ws.onopen=function(){clearTimeout(tm);var p=Date.now()-st;var el=G(elId);if(el)el.innerText=p+'ms';try{ws.close();}catch(e){}};ws.onerror=function(){var el=G(elId);if(el)el.innerText=s(17);if(url===C)auto();};}catch(e){var el=G(elId);if(el)el.innerText=s(17);}}function allP(){Object.keys(W).forEach(function(k){ping(W[k],'ping-'+k);});}function auto(){var keys=Object.keys(W);for(var i=0;i<keys.length;i++){var k=keys[i];var el=G('ping-'+k);var tx=el?el.innerText:s(17);if(tx!==s(17)&&tx!==s(18)){setW(k);var bar=G(s(7));if(bar){bar.placeholder='AUTO-RECOVERY: Switched to '+k;setTimeout(function(){bar.placeholder=s(13);},4000);}return;}}}setInterval(function(){var key=localStorage.getItem(s(1))||'main';ping(C,'ping-'+key);},10000);function showBH(){var e=G(s(3));if(!e)return;e.style.display='flex';e.style.opacity='1';}function hideBH(){var e=G(s(3));if(!e)return;e.style.opacity='0';setTimeout(function(){e.style.display='none';},500);}function newTab(){var id=Date.now()+Math.random();T.push({id:id,url:'',title:'New Tab',loading:false});var fr=document.createElement('iframe');fr.id='frame-'+id;fr.onload=function(){var t=T.find(function(x){return x.id===id;});if(t){t.loading=false;render();hideBH();}};G(s(8)).appendChild(fr);switchTab(id);}function switchTab(id){A=id;QSA('iframe').forEach(function(f){f.classList.remove('active');});var fr=G('frame-'+id);if(fr)fr.classList.add('active');var tab=T.find(function(t){return t.id===A;});var bar=G(s(7));if(bar)bar.value=tab&&tab.url?tab.url:'';var nt=G(s(9));if(nt)nt.style.display=(fr&&fr.src)?'none':'flex';render();}function render(){var strip=G(s(10));if(!strip)return;var addBtn=strip.querySelector('.nav-button');QSA('.tab',strip).forEach(function(t){t.remove();});T.forEach(function(tab){var el=document.createElement('div');el.className='tab'+(tab.id===A?' active':'');el.setAttribute('data-action','switchTab');el.setAttribute('data-id',String(tab.id));var sp=document.createElement('span');sp.style.cssText='flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;';sp.textContent=tab.title;var cb=document.createElement('button');cb.className='close-tab-btn';cb.type='button';cb.setAttribute('data-action','closeTab');cb.setAttribute('data-id',String(tab.id));cb.textContent='Ã—';el.appendChild(sp);el.appendChild(cb);strip.insertBefore(el,addBtn);});}function nav(){var bar=G(s(7));var val=bar?String(bar.value||'').trim():'';if(!val||!A)return;if(document.activeElement)document.activeElement.blur();showBH();var url=(val.includes('.')&&!val.includes(' '))?(val.startsWith('http')?val:'https://'+val):('https://search.brave.com/search?q='+encodeURIComponent(val));var tab=T.find(function(t){return t.id===A;});if(tab){tab.url=url;tab.title=(url.split('/')[2]||url);}var enc=SJ.encodeUrl(url);if(typeof enc==='string'&&enc.startsWith('/'))enc=new URL(enc,location.origin).toString();var fr=G('frame-'+A);if(fr)fr.src=enc;var nt=G(s(9));if(nt)nt.style.display='none';render();}function reload(){if(!A)return;var fr=G('frame-'+A);if(!fr||!fr.src)return;showBH();try{fr.contentWindow.location.reload();}catch(e){fr.src=fr.src;}}setInterval(function(){if(!A)return;var fr=G('frame-'+A);if(!fr||!fr.src)return;try{var path=fr.contentWindow.location.pathname;if(path.includes(PFX)){var part=path.split(PFX)[1];var dec=SJ.decodeUrl(location.origin+PFX+part);var tab=T.find(function(t){return t.id===A;});var bar=G(s(7));if(tab&&tab.url!==dec&&document.activeElement!==bar){tab.url=dec;if(bar)bar.value=dec;}}}catch(e){}},1000);function hideNav(){document.body.classList.add(s(12));hideSet();}function about(){var win=window.open('about:blank','_blank');if(!win)return;var doc=win.document;var ifr=doc.createElement('iframe');doc.title=(localStorage.getItem(s(0))==='true')?'My Drive - Google Drive':'OwO Browser';ifr.style='position:fixed;top:0;left:0;width:100%;height:100%;border:none;';ifr.src=location.href;doc.body.appendChild(ifr);location.replace('https://google.com');}function closeTab(id){if(T.length===1)return;T=T.filter(function(t){return t.id!==id;});var el=G('frame-'+id);if(el)el.remove();if(A===id&&T[0])switchTab(T[0].id);else render();}function showSet(){var m=G(s(4));if(m)m.classList.add('show');allP();}function hideSet(){var m=G(s(4));if(m)m.classList.remove('show');}function back(){if(!A)return;try{G('frame-'+A).contentWindow.history.back();}catch(e){}}function fwd(){if(!A)return;try{G('frame-'+A).contentWindow.history.forward();}catch(e){}}function fs(){if(!document.fullscreenElement)document.documentElement.requestFullscreen();else document.exitFullscreen();}function bind(){var bar=G(s(7));if(bar)bar.addEventListener('keydown',function(e){if(e.key==='Enter')nav();});document.addEventListener('click',function(e){var n=e.target.closest('[data-action]');if(!n)return;var a=n.getAttribute('data-action');if(a==='stopPropagation'){e.stopPropagation();return;}if(a==='newTab'){newTab();return;}if(a==='back'){back();return;}if(a==='forward'){fwd();return;}if(a==='reload'){reload();return;}if(a==='showSettings'){showSet();return;}if(a==='hideSettings'){hideSet();return;}if(a==='fullscreen'){fs();return;}if(a==='aboutBlank'){about();return;}if(a==='hideNavbar'){hideNav();return;}if(a==='toggleCloak'){toggleC();return;}if(a==='setCustomWisp'){setCW();return;}if(a==='setWisp'){setW(n.getAttribute('data-wisp')||'main');return;}if(a==='switchTab'){var id=Number(n.getAttribute('data-id'));if(id)switchTab(id);return;}if(a==='closeTab'){e.stopPropagation();var id=Number(n.getAttribute('data-id'));if(id)closeTab(id);return;}});}function boot(){cloakUI();loadWisp();initProxy();var ready=Promise.resolve();if('serviceWorker'in navigator){try{ready=navigator.serviceWorker.ready;}catch(e){ready=Promise.resolve();}}ready.then(function(){return SJ.init();}).then(function(){return SJ.modifyConfig({prefix:PFX});}).then(function(){newTab();allP();setTimeout(hideBH,1000);}).catch(function(err){console.error('app init failed',err);});}bind();addEventListener('load',boot);})();
