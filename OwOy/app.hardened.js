(function(){'use strict';var _S=["OwO Browser-cloaked","OwO Browser-wisp-key","OwO Browser-custom-wisp","loading-screen","settings-modal","cloak-toggle-btn","favicon","bar","frame-container","new-tab-ui","tab-strip","active-wisp","nav-hidden","Search with Brave or enter URL","SW register failed:","successfully connected to custom wisp server","failed to connect to custom wisp server url","ERR","--ms"];function _s(i){return _S[i];}var _B=new URL('./',location.href);function _u(p){return new URL(String(p).replace(/^\/+/,''),_B).toString();}function _p(p){return new URL(String(p).replace(/^\/+/,''),_B).pathname;}function _$(id){return document.getElementById(id);}function _qs(sel,root){return(root||document).querySelector(sel);}function _qsa(sel,root){return Array.prototype.slice.call((root||document).querySelectorAll(sel));}function _sw(){if(!('serviceWorker'in navigator))return;addEventListener('load',function(){navigator.serviceWorker.register(_u('sw.js'),{scope:_p('./')}).catch(function(e){console.error(_s(14),e);});});}_sw();var _W={main:"wss://dywhmcwp1y96m.cloudfront.net/wisp/",backup2:"wss://studyworkandmore.uk/wisp/",backup3:"wss://echo.websocket.org/",backup4:"wss://ws.ifelse.io/",backup5:"wss://2662r3426b.vicp.fun/xiaozhi/v1/",backup6:"wss://anura.pro/",backup7:"wss://gointospace.app/wisp/",backup8:"wss://dash.goip.de/wisp/",backup9:"wss://dash.goip.de/wisp/",backup10:"wss://"};var _T=[],_A=null,_C=_W.main;var _CONN=new BareMux.BareMuxConnection(_u('baremux/worker.js'));function _initProxy(){_CONN.setTransport(_u('libcurl/index.mjs'),[{websocket:_C}]);}var _PFX=new URL('./go/',location.href).pathname;var ScramjetController=$scramjetLoadController().ScramjetController;var _SJ=new ScramjetController({files:{all:_u('scram/scramjet.all.js'),wasm:_u('scram/scramjet.wasm.wasm'),sync:_u('scram/scramjet.sync.js')},prefix:_PFX});function _cloakUI(){var v=localStorage.getItem(_s(0))==='true';var b=_$(_s(5));if(v){document.title='My Drive - Google Drive';_$(_s(6)).href='https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png';if(b){b.innerText='Disable Tab Cloaking';b.classList.add(_s(11));}}else{document.title='OwO Browser';_$(_s(6)).href='https://leonowo-6369d.web.app/images/favico.ico';if(b){b.innerText='Enable Tab Cloaking (Drive)';b.classList.remove(_s(11));}}}function _toggleC(){var v=localStorage.getItem(_s(0))==='true';localStorage.setItem(_s(0),String(!v));_cloakUI();}function _loadWisp(){var k=localStorage.getItem(_s(1));var cw=localStorage.getItem(_s(2));if(cw){_C=cw;var inp=_$('custom-wisp-url');if(inp)inp.value=cw;_qsa('.'+_s(11)).forEach(function(x){x.classList.remove(_s(11));});}else if(k&&_W[k]){_C=_W[k];_qsa('.'+_s(11)).forEach(function(x){x.classList.remove(_s(11));});var btn=_$('wisp-'+k);if(btn)btn.classList.add(_s(11));}}function _setW(t){_C=_W[t];localStorage.setItem(_s(1),t);localStorage.removeItem(_s(2));_qsa('.'+_s(11)).forEach(function(x){x.classList.remove(_s(11));});var b=_$('wisp-'+t);if(b)b.classList.add(_s(11));_initProxy();}function _setCW(){var inp=_$('custom-wisp-url');var url=inp?String(inp.value||'').trim():'';if(!url.startsWith('ws')){alert(_s(16));return;}var sock;try{sock=new WebSocket(url);}catch(e){alert(_s(16));return;}var tm=setTimeout(function(){try{sock.close();}catch(e){};alert(_s(16));},5000);sock.onopen=function(){clearTimeout(tm);_C=url;localStorage.setItem(_s(2),url);localStorage.removeItem(_s(1));_qsa('.'+_s(11)).forEach(function(x){x.classList.remove(_s(11));});_initProxy();try{sock.close();}catch(e){}alert(_s(15));};sock.onerror=function(){clearTimeout(tm);alert(_s(16));};}function _ping(url,elId){var st=Date.now();try{var s=new WebSocket(url);var tm=setTimeout(function(){try{s.close();}catch(e){};},3000);s.onopen=function(){clearTimeout(tm);var p=Date.now()-st;var el=document.getElementById(elId);if(el)el.innerText=p+'ms';try{s.close();}catch(e){}};s.onerror=function(){var el=document.getElementById(elId);if(el)el.innerText=_s(17);if(url===_C)_auto();};}catch(e){var el=document.getElementById(elId);if(el)el.innerText=_s(17);}}function _allP(){Object.keys(_W).forEach(function(k){_ping(_W[k],'ping-'+k);});}function _auto(){var keys=Object.keys(_W);for(var i=0;i<keys.length;i++){var k=keys[i];var el=document.getElementById('ping-'+k);var tx=el?el.innerText:_s(17);if(tx!==_s(17)&&tx!==_s(18)){_setW(k);var bar=_$(_s(7));if(bar){bar.placeholder='AUTO-RECOVERY: Switched to '+k;setTimeout(function(){bar.placeholder=_s(13);},4000);}return;}}}setInterval(function(){var key=localStorage.getItem(_s(1))||'main';_ping(_C,'ping-'+key);},10000);function _showBH(){var e=_$(_s(3));if(!e)return;e.style.display='flex';e.style.opacity='1';}function _hideBH(){var e=_$(_s(3));if(!e)return;e.style.opacity='0';setTimeout(function(){e.style.display='none';},500);}function _newTab(){var id=Date.now()+Math.random();_T.push({id:id,url:'',title:'New Tab',loading:false});var fr=document.createElement('iframe');fr.id='frame-'+id;fr.onload=function(){var t=_T.find(function(x){return x.id===id;});if(t){t.loading=false;_render();_hideBH();}};_$(_s(8)).appendChild(fr);_switch(id);}function _switch(id){_A=id;_qsa('iframe').forEach(function(f){f.classList.remove('active');});var fr=document.getElementById('frame-'+id);if(fr)fr.classList.add('active');var tab=_T.find(function(t){return t.id===_A;});var bar=_$(_s(7));if(bar)bar.value=tab&&tab.url?tab.url:'';var nt=_$(_s(9));if(nt)nt.style.display=(fr&&fr.src)?'none':'flex';_render();}function _render(){var strip=_$(_s(10));if(!strip)return;var addBtn=strip.querySelector('.nav-button');_qsa('.tab',strip).forEach(function(t){t.remove();});_T.forEach(function(tab){var el=document.createElement('div');el.className='tab'+(tab.id===_A?' active':'');el.setAttribute('data-action','switchTab');el.setAttribute('data-id',String(tab.id));var sp=document.createElement('span');sp.style.cssText='flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;';sp.textContent=tab.title;var cb=document.createElement('button');cb.className='close-tab-btn';cb.setAttribute('type','button');cb.setAttribute('data-action','closeTab');cb.setAttribute('data-id',String(tab.id));cb.textContent='Ã—';el.appendChild(sp);el.appendChild(cb);strip.insertBefore(el,addBtn);});}function _nav(){var bar=_$(_s(7));var val=bar?String(bar.value||'').trim():'';if(!val||!_A)return;if(document.activeElement)document.activeElement.blur();_showBH();var url=(val.includes('.')&&!val.includes(' '))?(val.startsWith('http')?val:'https://'+val):('https://search.brave.com/search?q='+encodeURIComponent(val));var tab=_T.find(function(t){return t.id===_A;});if(tab){tab.url=url;tab.title=(url.split('/')[2]||url);}var enc=_SJ.encodeUrl(url);if(typeof enc==='string'&&enc.startsWith('/'))enc=new URL(enc,location.origin).toString();var fr=document.getElementById('frame-'+_A);if(fr)fr.src=enc;var nt=_$(_s(9));if(nt)nt.style.display='none';_render();}function _reload(){if(!_A)return;var fr=document.getElementById('frame-'+_A);if(!fr||!fr.src)return;_showBH();try{fr.contentWindow.location.reload();}catch(e){fr.src=fr.src;}}setInterval(function(){if(!_A)return;var fr=document.getElementById('frame-'+_A);if(!fr||!fr.src)return;try{var path=fr.contentWindow.location.pathname;if(path.includes(_PFX)){var part=path.split(_PFX)[1];var dec=_SJ.decodeUrl(location.origin+_PFX+part);var tab=_T.find(function(t){return t.id===_A;});var bar=_$(_s(7));if(tab&&tab.url!==dec&&document.activeElement!==bar){tab.url=dec;if(bar)bar.value=dec;}}}catch(e){}},1000);function _hideNav(){document.body.classList.add(_s(12));_hideSet();}function _about(){var win=window.open('about:blank','_blank');if(!win)return;var doc=win.document;var ifr=doc.createElement('iframe');doc.title=(localStorage.getItem(_s(0))==='true')?'My Drive - Google Drive':'OwO Browser';ifr.style='position:fixed;top:0;left:0;width:100%;height:100%;border:none;';ifr.src=location.href;doc.body.appendChild(ifr);location.replace('https://google.com');}function _close(id){if(_T.length===1)return;_T=_T.filter(function(t){return t.id!==id;});var el=document.getElementById('frame-'+id);if(el)el.remove();if(_A===id&&_T[0])_switch(_T[0].id);else _render();}function _showSet(){var m=_$(_s(4));if(m)m.classList.add('show');_allP();}function _hideSet(){var m=_$(_s(4));if(m)m.classList.remove('show');}function _back(){if(!_A)return;try{document.getElementById('frame-'+_A).contentWindow.history.back();}catch(e){}}function _fwd(){if(!_A)return;try{document.getElementById('frame-'+_A).contentWindow.history.forward();}catch(e){}}function _fs(){if(!document.fullscreenElement){document.documentElement.requestFullscreen();}else{document.exitFullscreen();}}function _bind(){var mc=_qs('.modal-content');if(mc)mc.addEventListener('click',function(e){e.stopPropagation();});var bar=_$(_s(7));if(bar)bar.addEventListener('keydown',function(e){if(e.key==='Enter')_nav();});document.addEventListener('click',function(e){var n=e.target.closest('[data-action]');if(!n)return;var a=n.getAttribute('data-action');if(a==='stopPropagation'){e.stopPropagation();return;}if(a==='newTab'){_newTab();return;}if(a==='back'){_back();return;}if(a==='forward'){_fwd();return;}if(a==='reload'){_reload();return;}if(a==='showSettings'){_showSet();return;}if(a==='hideSettings'){_hideSet();return;}if(a==='fullscreen'){_fs();return;}if(a==='aboutBlank'){_about();return;}if(a==='hideNavbar'){_hideNav();return;}if(a==='toggleCloak'){_toggleC();return;}if(a==='setCustomWisp'){_setCW();return;}if(a==='setWisp'){_setW(n.getAttribute('data-wisp')||'main');return;}if(a==='switchTab'){var id=Number(n.getAttribute('data-id'));if(id)_switch(id);return;}if(a==='closeTab'){e.stopPropagation();var id=Number(n.getAttribute('data-id'));if(id)_close(id);return;}});}function _boot(){_cloakUI();_loadWisp();_initProxy();var ready=Promise.resolve();if('serviceWorker'in navigator){try{ready=navigator.serviceWorker.ready;}catch(e){ready=Promise.resolve();}}ready.then(function(){return _SJ.init();}).then(function(){return _SJ.modifyConfig({prefix:_PFX});}).then(function(){_newTab();_allP();setTimeout(_hideBH,1000);});}_bind();addEventListener('load',_boot);})();
